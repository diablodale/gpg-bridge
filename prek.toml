# prek.toml — git hook configuration
# https://prek.j178.dev/
#
# Hooks are installed automatically by `npm install` via the postinstall script.
# To reinstall manually:  prek install
# To bypass in an emergency: git commit --no-verify
#   Note: The GitHub repository ruleset still enforces commit signing.
#   The PR flow enforces the full test suite via CI.

default_install_hook_types = ["pre-commit", "commit-msg", "pre-push"]

[[repos]]
repo = "local"

# pre-commit: TypeScript compile — must pass before lint runs
[[repos.hooks]]
id = "compile"
name = "TypeScript compile"
language = "system"
entry = "npm run compile"
pass_filenames = false
always_run = true
stages = ["pre-commit"]
priority = 0

# pre-commit: ESLint — runs after compile
[[repos.hooks]]
id = "lint"
name = "ESLint"
language = "system"
entry = "npm run lint"
pass_filenames = false
always_run = true
stages = ["pre-commit"]
priority = 10

# commit-msg: Conventional Commits format via commitlint
# @commitlint/cli is installed as a devDependency — no separate install required.
[[repos.hooks]]
id = "conventional-commits"
name = "Conventional Commits"
language = "system"
entry = "node node_modules/@commitlint/cli/cli.js --edit"
pass_filenames = true
stages = ["commit-msg"]

# pre-push: unit tests only
[[repos.hooks]]
id = "tests"
name = "Unit tests"
language = "system"
entry = "npm test"
pass_filenames = false
always_run = true
stages = ["pre-push"]
